# Environment variables for TCP Hole Punching Project
# ------------------------------------------------------------------------------
# PLEASE UPDATE THE PLACEHOLDER VALUES BELOW (marked with '!!!')
# ------------------------------------------------------------------------------

# --- Google Cloud Settings (!!! REQUIRED FOR CLOUD DEPLOYMENT !!!) ---
# Replace with your actual Google Cloud Project ID
export PROJECT_ID="iceberg-eli"
# Replace with your desired Google Cloud region (e.g., us-central1, europe-west1)
export REGION="us-central1"
# Replace with your Artifact Registry repository name (e.g., tcp-holepunch-repo)
# Using 'rendezvous-repo' based on search, please VERIFY or CHANGE this!
export AR_REPO="rendezvous-repo" # !!! VERIFY OR CHANGE THIS !!!

# --- Rendezvous Service Settings ---
# Port for the Rendezvous service container (used in `gcloud run deploy` and if running locally)
# This is the port the application *inside the container* listens on.
export RENDEZVOUS_CONTAINER_PORT="8080"

# --- Worker Client Settings ---
# URL of the deployed Rendezvous Service.
# For local testing (if rendezvous service runs on RENDEZVOUS_CONTAINER_PORT):
# export RENDEZVOUS_SERVICE_URL="http://localhost:${RENDEZVOUS_CONTAINER_PORT}"
# (!!!) After deploying to Cloud Run, UPDATE THIS with the actual service URL:
export RENDEZVOUS_SERVICE_URL="https://rendezvous-service-982092720909.us-central1.run.app"

# --- Settings for Local Worker A (for testing) ---
# The internal TCP port Worker A will listen on for P2P connections.
export WORKER_A_INTERNAL_TCP_PORT="8082"
# The port for Worker A's own health check HTTP server (corresponds to $PORT in worker code).
export WORKER_A_HEALTH_PORT="8080"

# --- Settings for Local Worker B (for testing) ---
# The internal TCP port Worker B will listen on for P2P connections.
export WORKER_B_INTERNAL_TCP_PORT="8083"
# The port for Worker B's own health check HTTP server (corresponds to $PORT in worker code).
export WORKER_B_HEALTH_PORT="8081"

# --- (Optional) Worker Timeouts ---
# These can be uncommented and set to override defaults in the worker's code.
# export WS_OPEN_TIMEOUT="15.0"
# export WS_RECV_TIMEOUT="120.0"
# export LISTENER_READY_TIMEOUT="15.0"
# export P2P_MSG_TIMEOUT="10.0"

# --- Docker Image Names (used by redeploy.sh) ---
# These are defaults used by the redeploy.sh script.
export RENDEZVOUS_IMAGE_NAME="rendezvous-service"
export WORKER_IMAGE_NAME="holepunch-worker"

# --- Cloud Run Worker Service Names (if deploying workers to Cloud Run) ---
export WORKER_A_SERVICE_NAME="holepunch-worker-a"
export WORKER_B_SERVICE_NAME="holepunch-worker-b"

# --- Cloud Run Worker Health Check Ports ---
# These are the ports the worker containers will expose for their HTTP health checks on Cloud Run.
# The $PORT env var inside the worker container will be set to these values respectively.
export WORKER_A_CLOUDRUN_HEALTH_PORT="8080"
export WORKER_B_CLOUDRUN_HEALTH_PORT="8080" # Can be the same as A, as they are separate services

# --- Timeout Settings for redeploy.sh (in seconds) ---
export DOCKER_BUILD_TIMEOUT_SEC="1800"  # 30 minutes for docker buildx and push
export GCLOUD_DEPLOY_TIMEOUT_SEC="600" # 10 minutes for gcloud run deploy

# --- Image Tag Settings ---
# You can change this tag as needed, e.g., for versioning.
export RENDEZVOUS_IMAGE_TAG="latest"
export WORKER_IMAGE_TAG="latest" # Tag for the worker service image

# ------------------------------------------------------------------------------
# Note: After creating or modifying this file, run `direnv allow` in your terminal
# if you are using direnv, or source the file manually (source .envrc).
# Remember to replace all placeholder values marked with '!!!'.
# ------------------------------------------------------------------------------ 

# External Echo Service (NEW - Deployed to a different region for NAT traversal testing)
export EXTERNAL_ECHO_IMAGE_NAME="external-echo-service"
export EXTERNAL_ECHO_SERVICE_NAME="external-echo-service"
export EXTERNAL_ECHO_CONTAINER_PORT="8080"
export EXTERNAL_ECHO_REGION="europe-west1" # NEW: Region for the echo service
export EXTERNAL_ECHO_SERVER_HOST="external-echo-service-982092720909.europe-west1.run.app" # UPDATED
export EXTERNAL_ECHO_SERVER_PORT="443" # NEW: External port for Cloud Run service (HTTPS)
# export ECHO_VPC_CONNECTOR_NAME="echo-vpc-connector" # Keeping this commented, likely not needed if echo is public in another region

# --- VM-based External Echo Service settings (NEW) ---
# These are required when the echo service is deployed on a Compute Engine VM instead of Cloud Run.
# The redeploy.sh script will create (or recreate) the VM automatically.
#
# Name of the VM instance (must be unique within the project/zone)
export EXTERNAL_ECHO_VM_NAME="external-echo-vm" # CHANGE if you prefer a different name
# Compute Engine zone where the VM will live (should be in EXTERNAL_ECHO_REGION for lowest latency)
export EXTERNAL_ECHO_VM_ZONE="europe-west1-b"   # CHANGE if you prefer a different zone
# TCP port that will be exposed on the VM's external IP and forwarded to the container's 8080
export EXTERNAL_ECHO_VM_EXTERNAL_PORT="12345"   # CHANGE if you need a different public port

# The workers should dial the VM's external IP on the port above, so keep these two in sync
export EXTERNAL_ECHO_SERVER_PORT="${EXTERNAL_ECHO_VM_EXTERNAL_PORT}"

# --- STUN Server Settings (REMOVED - Replaced by external echo service in different region) ---
# export STUN_HOST="stun.sipnet.net"
# export STUN_PORT="3478"
